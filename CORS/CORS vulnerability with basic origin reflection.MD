## CORS vulnerability with basic origin reflection

Description bảo rằng:

***"This website has an insecure CORS configuration in that it trusts all origin"***

***To solve the lab, craft some JavaScript that uses CORS to retrieve the administrator's API key and upload the code to your exploit server. The lab is solved when you successfully submit the administrator's API key.***

> Có nghĩa là CORS được trust bất cứ ở domain nào, yêu cầu phải sử dụng js và lấy được APIKey của admin.

Sau khi login và chuyển qua xem thông tin tài khoản thì chúng ta sẽ bắt lại request accountDetail.

=> Có vẻ như Cors ở đây được sử dụng để cấp API KEY

![](/imgs/CORS/1.png?raw=true)

> **Response có tồn tại Access-Control-Allow-Credentials => Có support Cors**

Fetch-Site được set là “same-origin” có nghĩa là chỉ được truy cập với domain khớp với địa chỉ của web.

![](/imgs/CORS/2.png?raw=true)

Khi thêm trường origin với domain khác hoàn toàn nhưng web vẫn trả về response như trên nhưng có thêm dòng Allow-Origin là địa chỉ Origin mà mình thêm vào => Cors có vấn đề

![](/imgs/CORS/3.png?raw=true)

Ta sẽ tiến hành gửi 1 XMLHttprequest (dùng để gửi request cross-site trong js)

Sang Exploit Server và inject vào 1 đoạn script dùng để send request tới địa chỉ của Lab và log ra những response trả về.

![](/imgs/CORS/4.png?raw=true)

Check xem request gửi như nào bằng cách View exploit chúng ta sẽ thấy được tất cả request sẽ được gửi tới khi chúng ta bắt đầu load trang này.

![](/imgs/CORS/5.png?raw=true)

Tiến hành inject bằng cách Deliver exploit to victim

Sau đó xem lại exploit

![](/imgs/CORS/6.png?raw=true)

Chúng ta thấy cái gì admin ở kia, tiến hành decode link đọc cho dễ

![](/imgs/CORS/7.png?raw=true)

Sau khi thu được apikey ta sẽ submit là solve lab

![](/imgs/CORS/8.png?raw=true)

### Tài liệu tham khảo
- XMLHttprequest: [https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS)





