## Exploiting DOM clobbering to enable XSS

> Lab này chỉ ra là cho phép comment trong post bằng html mà không gây ra lỗi như html injection hay xss chẳng hạn.

![](/imgs/DOM-BASED-VULNERABILITIES/15.png?raw=true)

Tất nhiên là nếu comment ***<script>alert(1)</script>*** bình thường sẽ không gây ra hiệu ứng xss, nhưng nếu để ý ta sẽ thấy ở đây request sẽ được load thêm 1 cái là ***loadCommentWithDomClob*** (à thì ra có hàm escape html nên mới gọi là safe html :v).

![](/imgs/DOM-BASED-VULNERABILITIES/16.png?raw=true)

Có 1 hàm display comment ở đây để load cả avatar lên bằng ***window.defaultAvatar***

![](/imgs/DOM-BASED-VULNERABILITIES/17.png?raw=true)

Chúng ta sẽ chèn đoạn lệnh để set avatar, theo như function thì nếu có avatar thì nó sẽ chèn thêm 1 thẻ image với avatar đã set (ghi đè lên cái name avatar).

```html
<a id=defaultAvatar><a id=defaultAvatar name=avatar href="cid:&quot;onerror=alert(1)//">
```

2 thẻ a với id giống nhau để cố tình gây ra error để ghi đè code, rồi gọi ra ***cid:&quot;*** để đóng dấu ngoặc đôi lại và event onerror được chạy.

Khi comment thêm 1 lần nữa thì avatar sẽ được reload và xss sẽ được thực thi => Solve lab

![](/imgs/DOM-BASED-VULNERABILITIES/18.png?raw=true)

### Tài liệu tham khảo
- DOM-based Vuln: [https://portswigger.net/web-security/dom-based](https://portswigger.net/web-security/dom-based)