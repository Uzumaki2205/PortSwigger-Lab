## Exploiting XXE using external entities to retrieve files

> Description lab bảo là phần Check stock sử dụng XML để gửi đi, chúng ta phải làm cách nào để lấy được nội dung file passwd trên hệ thống.

Ta sẽ bắt request check stock và thêm vào đoạn DOCTYPE để request gửi đi có dạng XML vẫn hoàn chỉnh, đây là dạng XML DTD (có nghĩa là nó sẽ parse lại dữ liệu khi xử lý)

> Ví dụ từ w3: [https://www.w3schools.com/xml/xml_dtd.asp](https://www.w3schools.com/xml/xml_dtd.asp)

![](/imgs/XXE/1.png?raw=true)

Entity sẽ bắt đầu bằng & và kết thúc bằng ***;***

![](/imgs/XXE/2.png?raw=true)

Còn XML External Entities sẽ có dạng như này để truy cập vào file hoặc link.

![](/imgs/XXE/3.png?raw=true)

Do lab có Enpoint Stockcheck dữ liệu đầu vào XML => Chúng ta sẽ áp dụng để inject vào request này.

```XML
<!DOCTYPE test [ <!ENTITY test SYSTEM "file:///etc/passwd"> ]>
```

> Nội dung của file passwd sẽ trả dữ liệu về cho biến test

![](/imgs/XXE/6.png?raw=true)

> ***File:///*** là đường dẫn của file trên máy nhé

> Ví dụ của mình là ***file:///C:/Users/lengo/Downloads/Documents/300%20ba%CC%80i%20code%20thie%CC%82%CC%81u%20nhi.pdf*** là đường dẫn của 1 file pdf

![](/imgs/XXE/4.png?raw=true)
![](/imgs/XXE/5.png?raw=true)

### Tài Liệu Tham Khảo
- Một số CheatSheet: [https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html](https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html)